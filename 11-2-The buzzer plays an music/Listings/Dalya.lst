C51 COMPILER V9.59.0.0   DALYA                                                             11/21/2024 22:22:56 PAGE 1   


C51 COMPILER V9.59.0.0, COMPILATION OF MODULE DALYA
OBJECT MODULE PLACED IN .\Objects\Dalya.obj
COMPILER INVOKED BY: D:\RJ\Keil5\C51\BIN\C51.EXE Dalya.c OPTIMIZE(8,SPEED) BROWSE INCDIR(D:\RJ\Keil5\C51\INC;D:\RJ\Keil5
                    -\C51\INC\Atmel) DEBUG OBJECTEXTEND PRINT(.\Listings\Dalya.lst) TABS(2) OBJECT(.\Objects\Dalya.obj)

line level    source

   1          #include "Delay.h"
   2          
   3          void Delay(unsigned int xms) //@12MHz
   4          {
   5   1        unsigned char data i, j;
   6   1      
   7   1        while (xms--)
   8   1        {
   9   2          i = 2;
  10   2          j = 239;
  11   2          do
  12   2          {
  13   3            while (--j)
  14   3              ;
  15   3          } while (--i);
  16   2        }
  17   1      }
  18          
  19          
  20          void Timer0Init() // 1ms@12MHz
  21          {
  22   1        TMOD &= 0xF0; // æŠŠTMODçš„ä½Žå››ä½æ¸…é›¶ï¼Œé«˜å››ä½ä¿æŒä¸å˜
  23   1        TMOD |= 0x01; // æŠŠTMODçš„æœ€ä½Žä½ç½®1ï¼Œå…¶ä»–7ä½ä¿æŒä¸å˜ï¼Œè¿™é‡Œå³è®¾ç½®äº†å®šæ—¶å™¨0çš„æ¨¡å¼
             -æ˜¯å·¥ä½œæ–¹å¼1ï¼š16ä¸ºè®¡æ•°å™¨
  24   1        // è¿™æ ·åšçš„å¥½å¤„å°±åœ¨äºŽå¯ä»¥åªæ“ä½œTMODçš„å…¶ä¸­æŸäº›ä½è€Œä¸å½±å“å…¶ä»–ä½
  25   1      
  26   1        TF0 = 0; // è®¾ç½®T0å®šæ—¶å™¨æº¢å‡ºæ ‡å¿—ä½ä¸º0
  27   1        TR0 = 1; // å³å¯åŠ¨å®šæ—¶å™¨0å¼€å§‹è®¡æ—¶
  28   1      
  29   1        TH0 = 0xFC; // è®¾ç½®å®šæ—¶åˆå§‹å€¼ä¸º64535+1
  30   1        TL0 = 0x18;
  31   1        // å¦ä¸€å†™æ³•
  32   1        //  TH0=64535/256;//ä½œç”¨å³å¾—åˆ°64535è½¬16è¿›åˆ¶åŽçš„é«˜8ä½ï¼Œè¿™é‡Œé™¤çš„ç»“æžœåªå–æ•´æ•°ï¼Œä¸å–
             -å°æ•°
  33   1        //                ï¼ˆç»“æžœå³åè¿›åˆ¶çš„252ï¼Œè½¬16è¿›åˆ¶å°±æ˜¯FCï¼Œåˆšå¥½å°±æ˜¯64535çš„åå…­è¿›åˆ¶é«˜8ä½ï¼‰
  34   1        //  TL0=64535%256+1;//ç»“æžœå³64535è½¬16è¿›åˆ¶åŽçš„ä½Ž8ä½ï¼ˆåŒç†ï¼Œè‡ªå·±è®¡ç®—ï¼‰ï¼Œ+1æ˜¯å› ä¸ºå®šæ—
             -¶å™¨
  35   1        // æœ€å¤§å®šæ—¶ä¸º65535ï¼Œè€Œå®šæ—¶å™¨è¦åˆ°65536æ‰æº¢å‡ºï¼Œæ‰€ä»¥64535åˆ°65536æ˜¯1001ï¼Œå¤šäº†1å¾®ç§’ï¼
             -Œè¿™æ ·å®šæ—¶å°±æ˜¯1.001ms
  36   1      
  37   1        ET0 = 1; // T0å¯¹åº”çš„ä¸­æ–­å¼€å…³é—­åˆ
  38   1        EA = 1;  // ä¸­æ–­æ€»å¼€å…³é—­åˆ
  39   1        PT0 = 0; // è®¾ç½®ä¸­æ–­ä¼˜å…ˆçº§ä¸ºä½Žçº§
  40   1      }
  41          
  42          /*ä¸Šé¢çš„çš„å®šæ—¶å™¨åˆå§‹åŒ–ç¨‹åºè¦é…åˆä¸‹é¢çš„å®šæ—¶å™¨ä¸­æ–­ç¨‹åºæ¨¡æ¿ï¼Œåªä¸è¿‡ä¸­æ–­ç¨‹åº
             -è¦å†™åˆ°ä¸»å‡½æ•°æ–‡ä»¶ä¸Žä¸»å‡½æ•°é…åˆ
  43          void Timer0_Routine() interrupt 1 //å®šæ—¶å™¨T0çš„ä¸­æ–­ç¨‹åºå‡½æ•°å‘½åéšæ„ï¼Œinterrupt 1ç”¨äºŽå°†æ­¤
             -å‡½æ•°å®šä¹‰ä¸ºå®šæ—¶å™¨0çš„ä¸­æ–­ç¨‹åº
  44          {
  45            static unsigned int T0Count;//é™æ€å˜é‡ä½¿å¾—è¯¥å˜é‡å‡ºäº†æ­¤å‡½æ•°ä»ç„¶ä¸ä¼šè¢«é”€æ¯
  46            TH0=0xFC;//æ¯æ¬¡è®¡æ—¶è®¡å®ŒåŽéœ€è¦é‡æ–°èµ‹åˆå€¼ï¼Œè‹¥
  47            TL0=0x18;//ä¸èµ‹åˆå€¼ï¼Œå®ƒä¼šé»˜è®¤é‡0å¼€å§‹è®¡æ—¶,è¿™é‡Œè®¾ç½®çš„æ—¶æ¯éš”1msæ‰§è¡Œä¸€æ¬¡ä¸­æ–­
  48            T0Count++;
C51 COMPILER V9.59.0.0   DALYA                                                             11/21/2024 22:22:56 PAGE 2   

  49            if(T0Count>=1000)
  50            {
  51              T0Count=0;
  52          
  53            }
  54          }
  55          */
  56          
  57          
  58          void DS1302_Init(void)
  59          {
  60   1        DS1302_SCLK = 0;
  61   1        DS1302_CE = 0;
  62   1      }
  63          
  64          void DS1302_WriteByte(unsigned char command, unsigned char Date)
  65          {
  66   1        unsigned char i;
  67   1        DS1302_CE = 1;
  68   1      
  69   1        for (i = 0; i < 8; i++)
  70   1        {
  71   2          DS1302_IO = command & (0x01 << i);
  72   2          DS1302_SCLK = 1;
  73   2          DS1302_SCLK = 0;
  74   2        }
  75   1      
  76   1        for (i = 0; i < 8; i++)
  77   1        {
  78   2          DS1302_IO = Date & (0x01 << i);
  79   2          DS1302_SCLK = 1;
  80   2          DS1302_SCLK = 0;
  81   2        }
  82   1        DS1302_CE = 0;
  83   1      }
  84          
  85          unsigned char DS1302_ReadByte(unsigned char command)
  86          {
  87   1        unsigned char i;
  88   1        unsigned char Data = 0x00;
  89   1        command |= 0x01; // è¿™ä¸€å¥çš„ä½œç”¨å°±åœ¨äºŽï¼Œç»™å‡½æ•°DS1302_ReadByteå†™çš„åœ°å€ï¼Œç„¶åŽ
  90   1                //æœ€åŽä¸€ä½ç½®1å°±æ˜¯å¯¹åº”è¯»çš„åœ°å€
  91   1      
  92   1        DS1302_CE = 1;
  93   1        for (i = 0; i < 8; i++)
  94   1        {
  95   2          DS1302_IO = command & (0x01 << i);
  96   2          DS1302_SCLK = 0;
  97   2          DS1302_SCLK = 1;
  98   2        }
  99   1      
 100   1        for (i = 0; i < 8; i++)
 101   1        {
 102   2          DS1302_SCLK = 1;
 103   2          DS1302_SCLK = 0;
 104   2          if (DS1302_IO)
 105   2          {
 106   3            Data |= (0x01 << i);
 107   3          }
 108   2        }
 109   1        DS1302_CE = 0;
 110   1        DS1302_IO = 0;
C51 COMPILER V9.59.0.0   DALYA                                                             11/21/2024 22:22:56 PAGE 3   

 111   1      
 112   1        return Data;
 113   1      }
 114          
 115          char DS1302_Time[7] = {23, 11, 19, 15, 41, 0, 6};
 116          
 117          void DS1302_SetTime(void)
 118          {
 119   1        DS1302_WriteByte(DS1302_WP, 0x00);// å…³é—­å†™ä¿æŠ¤
 120   1      
 121   1        DS1302_WriteByte(DS1302_YEAR, DS1302_Time[0] / 10 * 16 + DS1302_Time[0] % 10);
 122   1        DS1302_WriteByte(DS1302_MONTH, DS1302_Time[1] / 10 * 16 + DS1302_Time[1] % 10);
 123   1        DS1302_WriteByte(DS1302_DATE, DS1302_Time[2] / 10 * 16 + DS1302_Time[2] % 10);
 124   1        DS1302_WriteByte(DS1302_HOUR, DS1302_Time[3] / 10 * 16 + DS1302_Time[3] % 10);
 125   1        DS1302_WriteByte(DS1302_MINUTE, DS1302_Time[4] / 10 * 16 + DS1302_Time[4] % 10);
 126   1        DS1302_WriteByte(DS1302_SECOND, DS1302_Time[5] / 10 * 16 + DS1302_Time[5] % 10);
 127   1        DS1302_WriteByte(DS1302_DAY, DS1302_Time[6] / 10 * 16 + DS1302_Time[6] % 10);
 128   1      
 129   1        DS1302_WriteByte(DS1302_WP, 0x80); // æ‰“å¼€å†™ä¿æŠ¤
 130   1      }
 131          
 132          void DS1302_ReadTime(void)
 133          {
 134   1        unsigned char Temp;//ä¸­é—´å˜é‡
 135   1      
 136   1        Temp = DS1302_ReadByte(DS1302_YEAR);
 137   1        DS1302_Time[0] = Temp / 16 * 10 + Temp % 16;
 138   1        Temp = DS1302_ReadByte(DS1302_MONTH);
 139   1        DS1302_Time[1] = Temp / 16 * 10 + Temp % 16;
 140   1        Temp = DS1302_ReadByte(DS1302_DATE);
 141   1        DS1302_Time[2] = Temp / 16 * 10 + Temp % 16;
 142   1        Temp = DS1302_ReadByte(DS1302_HOUR);
 143   1        DS1302_Time[3] = Temp / 16 * 10 + Temp % 16;
 144   1        Temp = DS1302_ReadByte(DS1302_MINUTE);
 145   1        DS1302_Time[4] = Temp / 16 * 10 + Temp % 16;
 146   1        Temp = DS1302_ReadByte(DS1302_SECOND);
 147   1        DS1302_Time[5] = Temp / 16 * 10 + Temp % 16;
 148   1        Temp = DS1302_ReadByte(DS1302_DAY);
 149   1        DS1302_Time[6] = Temp / 16 * 10 + Temp % 16;
 150   1      }
 151          
 152          void Buzzer_Delay500us(void) //@11.0592MHz
 153          {
 154   1        unsigned char data i;
 155   1      
 156   1        _nop_();
 157   1        i = 227;
 158   1        while (--i)
 159   1          ;
 160   1      }
 161          
 162          void Buzzer_Time(unsigned int ms)
 163          {
 164   1        unsigned int i = 0;
 165   1        for (i = 0; i < ms*2; i++)
 166   1        {
 167   2          Buzzer = !Buzzer;
 168   2          Buzzer_Delay500us();
 169   2        }
 170   1      }


C51 COMPILER V9.59.0.0   DALYA                                                             11/21/2024 22:22:56 PAGE 4   

MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    649    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      7    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
